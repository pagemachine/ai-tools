import t from"jquery";import e from"@typo3/backend/modal.js";import a from"@typo3/backend/severity.js";import{MessageUtility as n}from"@typo3/backend/utility/message-utility.js";import{G as i}from"./GeneratorButton-165922a8.js";import{t as r,b as o}from"./RemoteCalls-daf43ba7.js";t((()=>{t(".textPromptSelect").on("change",(function(){const e=t(this).val();t(t(this).data("target")).val(e)}))})),t((()=>{const e=t(".t3js-alternative-badword-trigger").not(".click-handled");e.addClass("click-handled"),e.on("click",(async function(e){e.preventDefault(),e.stopPropagation();let a=t(this).data("text-badword");console.log(a),t(this).data("text-badword-field")&&(a=t(t(this).data("text-badword-field")).val().trim()),console.log("new: "+a);let n=t(t(this).data("text-imagelabelid-field")).val(),i=t(this).data("text-badwordid-field"),o=t(this).data("text-action-field"),l=t(this).data("text-funktion-field");await r(a,n,i,o,l)}))})),t((()=>{t(".textLabelSelect").on("change",(function(){const e=t(this).val();t(t(this).data("target")).val(e)}))})),t((()=>{t(".badwordtabelbtn").on("click",(function(e){e.preventDefault(),e.stopPropagation();s(t(this).data("uid-field"),!1)}))})),t((()=>{t(".textLabelSelect").on("change",(function(e){e.preventDefault(),e.stopPropagation();s(t(this).data("fileid"),!0)}))}));var l=[];function s(t,e){if(e&&(null==l[t]||0==l[t]))return;let a=document.getElementById("selectedimageLabel-"+t).value,n=document.getElementById("table-"+a+"-"+t);null!=l[t]&&l[t]>0&&l[t]!=a&&(console.log(l[t]),document.getElementById("table-"+l[t]+"-"+t).style.display="none");a<0||("none"===n.style.display?(n.style.display="table",l[t]=a):(n.style.display="none",l[t]=0))}function d(){const e=c(document.getElementById("skipExistingDescriptions").checked);t(".t3-alternative-generate-all-total-images").text(e.length);const a=t(e).find(".t3js-ai-tools-credits-view-helper[data-credits]");total=0;for(let e of a){const a=Number(t(e).data("credits"));isNaN(a)||(total+=a)}element=document.getElementById("t3-alternative-generate-all-total-credits"),total?(element.innerHTML=total+" Credits",element.setAttribute("data-credits",total),element.style=""):(element.innerHTML="No Credits",element.setAttribute("data-credits",0),element.style="display: none;")}function c(e){return[...document.querySelectorAll(".imageEntry")].filter((a=>{const n=t(a).data("alternative");return!e||!n}))}function g(t){const e={actionName:"typo3:aiTools:updateField",value:t};n.send(e,function(){if(void 0!==window.parent&&void 0!==window.parent.document.list_frame&&null!==window.parent.document.list_frame.parent.document.querySelector(".t3js-modal-iframe"))return window.parent.document.list_frame;if(void 0!==window.parent&&void 0!==window.parent.frames.list_frame&&null!==window.parent.frames.list_frame.parent.document.querySelector(".t3js-modal-iframe"))return window.parent.frames.list_frame;if(void 0!==window.frames&&void 0!==window.frames.frameElement&&null!==window.frames.frameElement&&window.frames.frameElement.classList.contains("t3js-modal-iframe"))return window.frames.frameElement.contentWindow.parent;if(window.opener)return window.opener}())}t((()=>{RemoteCalls.initBadwordButton()})),t((()=>{t(".t3js-alternative-use-current-trigger").on("click",(function(e){e.preventDefault(),e.stopPropagation();const a=t(t(this).data("output-target")),n=t(this).data("current-text"),i=t(this).data("show-target");a.val(n),i&&t(i).show()}))})),t((()=>{t(".t3js-alternative-save-trigger").on("click",(async function(e){e.preventDefault(),e.stopPropagation();const a=t(this).data("file-identifier"),n=t(this).data("target-language"),i=t(this).data("translation-hash"),r=t(t(this).data("output-target")),l=t(t(this).data("button-target")),s=Number(t(this).data("translate")),d=r.val();l.prop("disabled",!0),l.addClass("saving"),t(this).addClass("generating");const c=await o(a,n,d,s).finally((()=>{l.prop("disabled",!1),l.removeClass("saving"),t(this).removeClass("generating")}));if(g(d),t(".t3js-alternative-use-trigger").trigger("click"),console.log("Saving Metadata",c),i)for(const e of c.translations){t("#translate-"+i+"-"+e.languageId).text(e.altTextTranslated)}}))})),t((()=>{const n=new i;t(".t3js-alternative-generate-all").on("click",(async function(i){i.preventDefault(),i.stopPropagation();var r=t(".progressBar").first();const o=Boolean(t(this).data("translate")),l=document.getElementById("skipExistingDescriptions").checked;if(!l){if(!await async function(t){return new Promise((n=>{void 0!==e&&e.confirm?e.confirm("Confirmation Required",t,a.warning,[{text:"Yes",active:!0,btnClass:"btn-warning",name:"yes",trigger:function(){n(!0),e.dismiss()}},{text:"No",name:"no",trigger:function(){n(!1),e.dismiss()}}]):n(confirm(t))}))}("This will overwrite existing descriptions. Are you sure you want to continue?"))return}t(".t3js-alternative-generate-all").prop("disabled",!0),t(".t3js-alternative-generate-all").addClass("generating");const s=c(l);r.attr("max",s.length),r.val(0);for(let e of s){try{const a=t(e).find(".t3js-alternative-generator-trigger").first(),i=t(e).find('.t3js-alternative-save-trigger[data-translate="0"]').first(),r=t(e).find('.t3js-alternative-save-trigger[data-translate="1"]').first();if(await n.triggerGeneratorButton(a),o){if(!r.length)return void console.error("No saveTranslate button found");r.trigger("click")}else{if(!i.length)return void console.error("No save button found");i.trigger("click")}t(e).css("border","1px solid green")}catch(a){console.error("Error while generating metadata",a),t(e).css("border","1px solid red")}r.val(r.val()+1)}t(".t3js-alternative-generate-all").prop("disabled",!1),t(".t3js-alternative-generate-all").removeClass("generating")})),t(".globalTextPrompt").on("change",(function(){t(".textPromptSelect").val(t(this).val()).trigger("change")})),t(".globalTextLabel").on("change",(function(){t(".textLabelSelect").val(t(this).val()).trigger("change")}))})),t((()=>{document.addEventListener("creditsUpdate",(t=>{d()})),t("#skipExistingDescriptions").on("change",(function(){d()})),d()})),t((()=>{t(".t3js-alternative-use-trigger").on("click",(async function(e){e.preventDefault(),e.stopPropagation();g(t(t(this).data("output-target")).val())}))}));
