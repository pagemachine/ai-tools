import t from"@typo3/backend/modal.js";import e from"@typo3/backend/severity.js";const a={images:TYPO3.settings.ajaxUrls.aitools_ai_tools_images,credits:TYPO3.settings.ajaxUrls.aitools_ai_tools_credits,badwords:TYPO3.settings.ajaxUrls.aitools_ai_tools_badwords};async function o(t,e){var a=Object.keys(t).map((e=>e+"="+encodeURIComponent(t[e]))).join("&");return new Promise(((t,o)=>{var r=new XMLHttpRequest;r.open("POST",e,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE&&200===this.status){var e=JSON.parse(this.responseText);if(e.error)return void o(e.error);t(e)}else 200!==this.status&&o("Error: status "+this.status)},r.send(a)}))}async function r(t,e,r,n,s){const i={action:"generateMetaData",target:t,"target-language":e,textPrompt:r,imageLabel:n,badwords:s};return top.TYPO3.Notification.info("Generating Metadata","Generating Metadata...",5),o(i,a.images).then((t=>{if(t)return top.TYPO3.Notification.success("Generated Metadata","Generated Metadata successful",5),t;throw"Error: empty response"})).catch((t=>{throw top.TYPO3.Notification.error("Error","(Meta) Error: "+t,5),t}))}async function n(t){return o({action:"credits",...t},a.credits).then((t=>{if(t)return t;throw"Error: empty response"}))}async function s(t,e,r,n=0){return o({action:"saveMetaData",target:t,"target-language":e,altText:r,translate:n},a.images).then((t=>{if(t)return top.TYPO3.Notification.success("Saved Metadata successful","Saved Metadata successful",5),t;throw"Error: empty response"})).catch((t=>{throw top.TYPO3.Notification.error("Error","(Saving) Error: "+t,5),t}))}async function i(t,e,r,n,s){if(!("badword"!=s&&"metabadword"!=s||""!==t&&","!=t))return void await d("You need to enter a stopword to proceed.","Parameters Missing");if(e<0)return void await d("You need to select a label to proceed.","Parameters Missing");let i={},c=[];"badword"==s||"metabadword"==s?(c=t.split(","),i={funktion:s,badword:c[0],imagelabelid:e,badwordid:r,action:n}):"label"==s&&(i={funktion:s,imagelabelid:e,action:n});let l=[];if("cut"==n&&await d("Are you sure you want to delete this record?","Confirmation"),console.log(i),await o(i,a.badwords).then((t=>{console.log("Erfolg:",t)})).catch((t=>{"Error: status 409"===t&&l.push(c[0])})),("badword"==s||"metabadword"==s)&&"add"===n&&c.length>1){let t=c.slice(1);for(const e of t)i.badword=e,await o(i,a.badwords).then((t=>{console.log("Erfolg:",t)})).catch((t=>{"Error: status 409"===t&&l.push(e)}))}l.length>=1&&await d("The word"+(1===l.length?" ":"s ")+l.join(", ")+" could not be "+("add"===n?"added":"changed")+" because "+(1===l.length?"it":"they")+" already exists.","Duplicate"),l.length>0&&l.length===c.length||setTimeout((()=>{window.location.reload()}),100)}async function d(a,o){return new Promise((r=>{void 0!==t&&t.confirm?t.confirm(o,a,e.warning,[{text:"Ok",active:!0,btnClass:"btn-warning",name:"ok",trigger:function(){r(!0),t.dismiss()}}]):r(confirm(a))}))}export{n as a,s as b,r as c,i as t};
