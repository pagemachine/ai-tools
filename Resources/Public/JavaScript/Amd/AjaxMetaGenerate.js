define(["jquery","TYPO3/CMS/Backend/Modal","TYPO3/CMS/Backend/Severity","TYPO3/CMS/Backend/Utility/MessageUtility","./GeneratorButton","./RemoteCalls"],(function(t,e,a,n,r,i){"use strict";function l(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=l(t),s=l(e),d=l(a);function u(){const t=f(document.getElementById("skipExistingDescriptions").checked);o.default(".t3-alternative-generate-all-total-images").text(t.length);const e=o.default(t).find(".t3js-ai-tools-credits-view-helper[data-credits]");total=0;for(let t of e){const e=Number(o.default(t).data("credits"));isNaN(e)||(total+=e)}element=document.getElementById("t3-alternative-generate-all-total-credits"),total?(element.innerHTML=total+" Credits",element.setAttribute("data-credits",total),element.style=""):(element.innerHTML="No Credits",element.setAttribute("data-credits",0),element.style="display: none;")}function f(t){return[...document.querySelectorAll(".imageEntry")].filter((e=>{const a=o.default(e).data("alternative");return!t||!a}))}function c(t){const e={actionName:"typo3:aiTools:updateField",value:t};n.MessageUtility.send(e,function(){if(void 0!==window.parent&&void 0!==window.parent.document.list_frame&&null!==window.parent.document.list_frame.parent.document.querySelector(".t3js-modal-iframe"))return window.parent.document.list_frame;if(void 0!==window.parent&&void 0!==window.parent.frames.list_frame&&null!==window.parent.frames.list_frame.parent.document.querySelector(".t3js-modal-iframe"))return window.parent.frames.list_frame;if(void 0!==window.frames&&void 0!==window.frames.frameElement&&null!==window.frames.frameElement&&window.frames.frameElement.classList.contains("t3js-modal-iframe"))return window.frames.frameElement.contentWindow.parent;if(window.opener)return window.opener}())}o.default((()=>{o.default(".textPromptSelect").on("change",(function(){const t=JSON.parse(o.default(this).val());o.default(o.default(this).data("target")).val(t.prompt),o.default(o.default(this).data("target")).attr("data-text-prompt-language",t.language)}))})),o.default((()=>{o.default(".t3js-alternative-use-current-trigger").on("click",(function(t){t.preventDefault(),t.stopPropagation();const e=o.default(o.default(this).data("output-target")),a=o.default(this).data("current-text"),n=o.default(this).data("show-target");e.val(a),n&&o.default(n).show()}))})),o.default((()=>{o.default(".t3js-alternative-save-trigger").on("click",(async function(t){t.preventDefault(),t.stopPropagation();const e=o.default(this).data("file-identifier"),a=o.default(this).data("target-language"),n=o.default(this).data("translation-hash"),r=o.default(o.default(this).data("output-target")),l=o.default(o.default(this).data("button-target")),s=Number(o.default(this).data("translate")),d=r.val();l.prop("disabled",!0),l.addClass("saving"),o.default(this).addClass("generating");const u=await i.callAjaxSaveMetaDataAction(e,a,d,s).finally((()=>{l.prop("disabled",!1),l.removeClass("saving"),o.default(this).removeClass("generating")}));if(c(d),o.default(".t3js-alternative-use-trigger").trigger("click"),console.log("Saving Metadata",u),n)for(const t of u.translations){o.default("#translate-"+n+"-"+t.languageId).text(t.altTextTranslated)}}))})),o.default((()=>{const t=new r.GeneratorButton;o.default(".t3js-alternative-generate-all").on("click",(async function(e){e.preventDefault(),e.stopPropagation();var a=o.default(".progressBar").first();const n=Boolean(o.default(this).data("translate")),r=document.getElementById("skipExistingDescriptions").checked;if(!r){if(!await async function(t){return new Promise((e=>{void 0!==s.default&&s.default.confirm?s.default.confirm("Confirmation Required",t,d.default.warning,[{text:"Yes",active:!0,btnClass:"btn-warning",name:"yes",trigger:function(){e(!0),s.default.dismiss()}},{text:"No",name:"no",trigger:function(){e(!1),s.default.dismiss()}}]):e(confirm(t))}))}("This will overwrite existing descriptions. Are you sure you want to continue?"))return}o.default(".t3js-alternative-generate-all").prop("disabled",!0),o.default(".t3js-alternative-generate-all").addClass("generating");const i=f(r);a.attr("max",i.length),a.val(0);for(let e of i){try{const a=o.default(e).find(".t3js-alternative-generator-trigger").first(),r=o.default(e).find('.t3js-alternative-save-trigger[data-translate="0"]').first(),i=o.default(e).find('.t3js-alternative-save-trigger[data-translate="1"]').first();if(await t.triggerGeneratorButton(a),n){if(!i.length)return void console.error("No saveTranslate button found");i.trigger("click")}else{if(!r.length)return void console.error("No save button found");r.trigger("click")}o.default(e).css("border","1px solid green")}catch(t){console.error("Error while generating metadata",t),o.default(e).css("border","1px solid red")}a.val(a.val()+1)}o.default(".t3js-alternative-generate-all").prop("disabled",!1),o.default(".t3js-alternative-generate-all").removeClass("generating")})),o.default(".globalTextPrompt").on("change",(function(){o.default(".textPromptSelect").val(o.default(this).val()).trigger("change")}))})),o.default((()=>{document.addEventListener("creditsUpdate",(t=>{u()})),o.default("#skipExistingDescriptions").on("change",(function(){u()})),u()})),o.default((()=>{o.default(".t3js-alternative-use-trigger").on("click",(async function(t){t.preventDefault(),t.stopPropagation();c(o.default(o.default(this).data("output-target")).val())}))}))}));
