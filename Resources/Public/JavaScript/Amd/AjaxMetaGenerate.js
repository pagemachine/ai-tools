define(["jquery","TYPO3/CMS/Backend/Modal","TYPO3/CMS/Backend/Severity","TYPO3/CMS/Backend/Utility/MessageUtility","./GeneratorButton-17825a0c","./RemoteCalls-4331d514"],(function(t,e,a,n,l,i){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var d=r(t),o=r(e),s=r(a);d.default((()=>{d.default(".textPromptSelect").on("change",(function(){const t=d.default(this).val();d.default(d.default(this).data("target")).val(t)}))})),d.default((()=>{const t=d.default(".t3js-alternative-badword-trigger").not(".click-handled");t.addClass("click-handled"),t.on("click",(async function(t){t.preventDefault(),t.stopPropagation();let e=d.default(this).data("text-badword");console.log(e),d.default(this).data("text-badword-field")&&(e=d.default(d.default(this).data("text-badword-field")).val().trim()),console.log("new: "+e);let a=d.default(d.default(this).data("text-imagelabelid-field")).val(),n=d.default(this).data("text-badwordid-field"),l=d.default(this).data("text-action-field"),r=d.default(this).data("text-funktion-field");await i.triggerBadwordButton(e,a,n,l,r)}))})),d.default((()=>{d.default(".textLabelSelect").on("change",(function(){const t=d.default(this).val();d.default(d.default(this).data("target")).val(t)}))})),d.default((()=>{d.default(".badwordtabelbtn").on("click",(function(t){t.preventDefault(),t.stopPropagation();f(d.default(this).data("uid-field"),!1)}))})),d.default((()=>{d.default(".textLabelSelect").on("change",(function(t){t.preventDefault(),t.stopPropagation();f(d.default(this).data("fileid"),!0)}))}));var u=[];function f(t,e){if(e&&(null==u[t]||0==u[t]))return;let a=document.getElementById("selectedimageLabel-"+t).value,n=document.getElementById("table-"+a+"-"+t);null!=u[t]&&u[t]>0&&u[t]!=a&&(console.log(u[t]),document.getElementById("table-"+u[t]+"-"+t).style.display="none");a<0||("none"===n.style.display?(n.style.display="table",u[t]=a):(n.style.display="none",u[t]=0))}function c(){const t=g(document.getElementById("skipExistingDescriptions").checked);d.default(".t3-alternative-generate-all-total-images").text(t.length);const e=d.default(t).find(".t3js-ai-tools-credits-view-helper[data-credits]");total=0;for(let t of e){const e=Number(d.default(t).data("credits"));isNaN(e)||(total+=e)}element=document.getElementById("t3-alternative-generate-all-total-credits"),total?(element.innerHTML=total+" Credits",element.setAttribute("data-credits",total),element.style=""):(element.innerHTML="No Credits",element.setAttribute("data-credits",0),element.style="display: none;")}function g(t){return[...document.querySelectorAll(".imageEntry")].filter((e=>{const a=d.default(e).data("alternative");return!t||!a}))}function m(t){const e={actionName:"typo3:aiTools:updateField",value:t};n.MessageUtility.send(e,function(){if(void 0!==window.parent&&void 0!==window.parent.document.list_frame&&null!==window.parent.document.list_frame.parent.document.querySelector(".t3js-modal-iframe"))return window.parent.document.list_frame;if(void 0!==window.parent&&void 0!==window.parent.frames.list_frame&&null!==window.parent.frames.list_frame.parent.document.querySelector(".t3js-modal-iframe"))return window.parent.frames.list_frame;if(void 0!==window.frames&&void 0!==window.frames.frameElement&&null!==window.frames.frameElement&&window.frames.frameElement.classList.contains("t3js-modal-iframe"))return window.frames.frameElement.contentWindow.parent;if(window.opener)return window.opener}())}d.default((()=>{RemoteCalls.initBadwordButton()})),d.default((()=>{d.default(".t3js-alternative-use-current-trigger").on("click",(function(t){t.preventDefault(),t.stopPropagation();const e=d.default(d.default(this).data("output-target")),a=d.default(this).data("current-text"),n=d.default(this).data("show-target");e.val(a),n&&d.default(n).show()}))})),d.default((()=>{d.default(".t3js-alternative-save-trigger").on("click",(async function(t){t.preventDefault(),t.stopPropagation();const e=d.default(this).data("file-identifier"),a=d.default(this).data("target-language"),n=d.default(this).data("translation-hash"),l=d.default(d.default(this).data("output-target")),r=d.default(d.default(this).data("button-target")),o=Number(d.default(this).data("translate")),s=l.val();r.prop("disabled",!0),r.addClass("saving"),d.default(this).addClass("generating");const u=await i.callAjaxSaveMetaDataAction(e,a,s,o).finally((()=>{r.prop("disabled",!1),r.removeClass("saving"),d.default(this).removeClass("generating")}));if(m(s),d.default(".t3js-alternative-use-trigger").trigger("click"),console.log("Saving Metadata",u),n)for(const t of u.translations){d.default("#translate-"+n+"-"+t.languageId).text(t.altTextTranslated)}}))})),d.default((()=>{const t=new l.GeneratorButton;d.default(".t3js-alternative-generate-all").on("click",(async function(e){e.preventDefault(),e.stopPropagation();var a=d.default(".progressBar").first();const n=Boolean(d.default(this).data("translate")),l=document.getElementById("skipExistingDescriptions").checked;if(!l){if(!await async function(t){return new Promise((e=>{void 0!==o.default&&o.default.confirm?o.default.confirm("Confirmation Required",t,s.default.warning,[{text:"Yes",active:!0,btnClass:"btn-warning",name:"yes",trigger:function(){e(!0),o.default.dismiss()}},{text:"No",name:"no",trigger:function(){e(!1),o.default.dismiss()}}]):e(confirm(t))}))}("This will overwrite existing descriptions. Are you sure you want to continue?"))return}d.default(".t3js-alternative-generate-all").prop("disabled",!0),d.default(".t3js-alternative-generate-all").addClass("generating");const i=g(l);a.attr("max",i.length),a.val(0);for(let e of i){try{const a=d.default(e).find(".t3js-alternative-generator-trigger").first(),l=d.default(e).find('.t3js-alternative-save-trigger[data-translate="0"]').first(),i=d.default(e).find('.t3js-alternative-save-trigger[data-translate="1"]').first();if(await t.triggerGeneratorButton(a),n){if(!i.length)return void console.error("No saveTranslate button found");i.trigger("click")}else{if(!l.length)return void console.error("No save button found");l.trigger("click")}d.default(e).css("border","1px solid green")}catch(t){console.error("Error while generating metadata",t),d.default(e).css("border","1px solid red")}a.val(a.val()+1)}d.default(".t3js-alternative-generate-all").prop("disabled",!1),d.default(".t3js-alternative-generate-all").removeClass("generating")})),d.default(".globalTextPrompt").on("change",(function(){d.default(".textPromptSelect").val(d.default(this).val()).trigger("change")})),d.default(".globalTextLabel").on("change",(function(){d.default(".textLabelSelect").val(d.default(this).val()).trigger("change")}))})),d.default((()=>{document.addEventListener("creditsUpdate",(t=>{c()})),d.default("#skipExistingDescriptions").on("change",(function(){c()})),c()})),d.default((()=>{d.default(".t3js-alternative-use-trigger").on("click",(async function(t){t.preventDefault(),t.stopPropagation();m(d.default(d.default(this).data("output-target")).val())}))}))}));
