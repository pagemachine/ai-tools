define(["jquery","TYPO3/CMS/Backend/Modal","TYPO3/CMS/Backend/Severity","TYPO3/CMS/Backend/Utility/MessageUtility","./GeneratorButton-d237fe8b","./RemoteCalls-fa38ce14"],(function(t,e,a,l,n,i){"use strict";function d(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=d(t),s=d(e),o=d(a);r.default((()=>{r.default(".textPromptSelect").on("change",(function(){const t=r.default(this).val();r.default(r.default(this).data("target")).val(t)}))})),r.default((()=>{r.default(".textLabelSelect").on("change",(function(){const t=r.default(this).val();r.default(r.default(this).data("target")).val(t),u(t,r.default(this).data("fileid"))}))}));let f=!0;function u(t,e){-1==t?r.default("#tag-div-"+e).find(".tag , .default-tag").each((function(){r.default(this).hide()})):(r.default("#tag-div-"+e).css("display","block"),r.default("#tag-div-"+e).find(".tag , .default-tag").each((function(){let e=r.default(this).data("imagelabelid");0==e||t==e?r.default(this).css("display","inline-block"):r.default(this).hide()})))}r.default((()=>{r.default(".hide-div").on("click",(function(){f?r.default("#hide-div-"+r.default(this).data("file")).css("display","block"):r.default("#hide-div-"+r.default(this).data("file")).hide(),f=!f}))})),r.default((()=>{r.default(".reset-tag, .global-reset-tag").on("click",(function(){let t=r.default(this).data("file");u(r.default("#selectedimageLabel-"+t).val(),t),"123"==t&&r.default(".reset-tag").trigger("click")}))}));let c=0;function g(){const t=m(document.getElementById("skipExistingDescriptions").checked);r.default(".t3-alternative-generate-all-total-images").text(t.length);const e=r.default(t).find(".t3js-ai-tools-credits-view-helper[data-credits]");total=0;for(let t of e){const e=Number(r.default(t).data("credits"));isNaN(e)||(total+=e)}element=document.getElementById("t3-alternative-generate-all-total-credits"),total?(element.innerHTML=total+" Credits",element.setAttribute("data-credits",total),element.style=""):(element.innerHTML="No Credits",element.setAttribute("data-credits",0),element.style="display: none;")}function m(t){return[...document.querySelectorAll(".imageEntry")].filter((e=>{const a=r.default(e).data("alternative");return!t||!a}))}function v(t){const e={actionName:"typo3:aiTools:updateField",value:t};l.MessageUtility.send(e,function(){if(void 0!==window.parent&&void 0!==window.parent.document.list_frame&&null!==window.parent.document.list_frame.parent.document.querySelector(".t3js-modal-iframe"))return window.parent.document.list_frame;if(void 0!==window.parent&&void 0!==window.parent.frames.list_frame&&null!==window.parent.frames.list_frame.parent.document.querySelector(".t3js-modal-iframe"))return window.parent.frames.list_frame;if(void 0!==window.frames&&void 0!==window.frames.frameElement&&null!==window.frames.frameElement&&window.frames.frameElement.classList.contains("t3js-modal-iframe"))return window.frames.frameElement.contentWindow.parent;if(window.opener)return window.opener}())}r.default(document).on("click",".add-tag, .global-add-tag",(function(){let t=r.default(this).data("file"),e=r.default("#tmp-add-badword-"+t).val();console.log(e+" "+t),e&&(r.default("#tag-div-"+t).children().eq(1).before(`\n    <span \n      class="tmp-tag" \n      id="tag-tmp-${c}-${t}" \n      data-value="${e}" \n      data-imagelabelid="0" \n      data-file="${t}">\n      ${e}\n      <a href="#" class="remove-tag" data-id="#tag-tmp-${c}-${t}" data-file="${t}">X</a>\n    </span>\n  `),c+=1,"123"==t&&(r.default(".add-container").each((function(){r.default(this).val(e)})),r.default(".add-tag").trigger("click"),r.default(".add-container").each((function(){r.default(this).val("")}))),r.default("#tmp-add-badword-"+t).val(""))})),r.default(document).on("click",".remove-tag",(function(){let t=!1;r.default(this).hasClass("tmp-tag")&&(t=!0);let e=r.default(r.default(this).data("id")).data("value");"123"==r.default(this).data("file")&&r.default(".scroll-container").each((function(){r.default(this).find(".default-tag, .tag, .tmp-tag").each((function(){r.default(this).data("value")===e&&(t?r.default(this).remove():r.default(this).hide())}))})),t?r.default(r.default(this).data("id")).remove():r.default(r.default(this).data("id")).hide()})),r.default((()=>{r.default(".t3js-alternative-use-current-trigger").on("click",(function(t){t.preventDefault(),t.stopPropagation();const e=r.default(r.default(this).data("output-target")),a=r.default(this).data("current-text"),l=r.default(this).data("show-target");e.val(a),l&&r.default(l).show()}))})),r.default((()=>{r.default(".t3js-alternative-save-trigger").on("click",(async function(t){t.preventDefault(),t.stopPropagation();const e=r.default(this).data("file-identifier"),a=r.default(this).data("target-language"),l=r.default(this).data("translation-hash"),n=r.default(r.default(this).data("output-target")),d=r.default(r.default(this).data("button-target")),s=Number(r.default(this).data("translate")),o=n.val();d.prop("disabled",!0),d.addClass("saving"),r.default(this).addClass("generating");const f=await i.callAjaxSaveMetaDataAction(e,a,o,s).finally((()=>{d.prop("disabled",!1),d.removeClass("saving"),r.default(this).removeClass("generating")}));if(v(o),r.default(".t3js-alternative-use-trigger").trigger("click"),console.log("Saving Metadata",f),l)for(const t of f.translations){r.default("#translate-"+l+"-"+t.languageId).text(t.altTextTranslated)}}))})),r.default((()=>{const t=new n.GeneratorButton;r.default(".t3js-alternative-generate-all").on("click",(async function(e){e.preventDefault(),e.stopPropagation();var a=r.default(".progressBar").first();const l=Boolean(r.default(this).data("translate")),n=document.getElementById("skipExistingDescriptions").checked;if(!n){if(!await async function(t){return new Promise((e=>{void 0!==s.default&&s.default.confirm?s.default.confirm("Confirmation Required",t,o.default.warning,[{text:"Yes",active:!0,btnClass:"btn-warning",name:"yes",trigger:function(){e(!0),s.default.dismiss()}},{text:"No",name:"no",trigger:function(){e(!1),s.default.dismiss()}}]):e(confirm(t))}))}("This will overwrite existing descriptions. Are you sure you want to continue?"))return}r.default(".t3js-alternative-generate-all").prop("disabled",!0),r.default(".t3js-alternative-generate-all").addClass("generating");const i=m(n);a.attr("max",i.length),a.val(0);for(let e of i){try{const a=r.default(e).find(".t3js-alternative-generator-trigger").first(),n=r.default(e).find('.t3js-alternative-save-trigger[data-translate="0"]').first(),i=r.default(e).find('.t3js-alternative-save-trigger[data-translate="1"]').first();if(await t.triggerGeneratorButton(a),l){if(!i.length)return void console.error("No saveTranslate button found");i.trigger("click")}else{if(!n.length)return void console.error("No save button found");n.trigger("click")}r.default(e).css("border","1px solid green")}catch(t){console.error("Error while generating metadata",t),r.default(e).css("border","1px solid red")}a.val(a.val()+1)}r.default(".t3js-alternative-generate-all").prop("disabled",!1),r.default(".t3js-alternative-generate-all").removeClass("generating")})),r.default(".globalTextPrompt").on("change",(function(){r.default(".textPromptSelect").val(r.default(this).val()).trigger("change")})),r.default(".globalTextLabel").on("change",(function(){const t=r.default(this).val();r.default(r.default(this).data("target")).val(t),u(t,r.default(this).data("fileid")),r.default(".textLabelSelect").val(r.default(this).val()).trigger("change")}))})),r.default((()=>{document.addEventListener("creditsUpdate",(t=>{g()})),r.default("#skipExistingDescriptions").on("change",(function(){g()})),g()})),r.default((()=>{r.default(".t3js-alternative-use-trigger").on("click",(async function(t){t.preventDefault(),t.stopPropagation();v(r.default(r.default(this).data("output-target")).val())}))}))}));
