define(["exports","TYPO3/CMS/Backend/Modal","TYPO3/CMS/Backend/Severity"],(function(t,e,a){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=o(e),n=o(a);const s={images:TYPO3.settings.ajaxUrls.aitools_ai_tools_images,credits:TYPO3.settings.ajaxUrls.aitools_ai_tools_credits,badwords:TYPO3.settings.ajaxUrls.aitools_ai_tools_badwords};async function i(t,e){var a=Object.keys(t).map((e=>e+"="+encodeURIComponent(t[e]))).join("&");return new Promise(((t,o)=>{var r=new XMLHttpRequest;r.open("POST",e,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE&&200===this.status){var e=JSON.parse(this.responseText);if(e.error)return void o(e.error);t(e)}else 200!==this.status&&o("Error: status "+this.status)},r.send(a)}))}async function d(t,e){return new Promise((a=>{void 0!==r.default&&r.default.confirm?r.default.confirm(e,t,n.default.warning,[{text:"Ok",active:!0,btnClass:"btn-warning",name:"ok",trigger:function(){a(!0),r.default.dismiss()}}]):a(confirm(t))}))}t.callAjaxCreditsAction=async function(t){return i({action:"credits",...t},s.credits).then((t=>{if(t)return t;throw"Error: empty response"}))},t.callAjaxMetaGenerateAction=async function(t,e,a,o,r){const n={action:"generateMetaData",target:t,"target-language":e,textPrompt:a,imageLabel:o,badwords:r};return top.TYPO3.Notification.info("Generating Metadata","Generating Metadata...",5),i(n,s.images).then((t=>{if(t)return top.TYPO3.Notification.success("Generated Metadata","Generated Metadata successful",5),t;throw"Error: empty response"})).catch((t=>{throw top.TYPO3.Notification.error("Error","(Meta) Error: "+t,5),t}))},t.callAjaxSaveMetaDataAction=async function(t,e,a,o=0){return i({action:"saveMetaData",target:t,"target-language":e,altText:a,translate:o},s.images).then((t=>{if(t)return top.TYPO3.Notification.success("Saved Metadata successful","Saved Metadata successful",5),t;throw"Error: empty response"})).catch((t=>{throw top.TYPO3.Notification.error("Error","(Saving) Error: "+t,5),t}))},t.triggerBadwordButton=async function(t,e,a,o,r){if(!("badword"!=r&&"metabadword"!=r||""!==t&&","!=t))return void await d("You need to enter a stopword to proceed.","Parameters Missing");if(e<0)return void await d("You need to select a label to proceed.","Parameters Missing");let n={},c=[];"badword"==r||"metabadword"==r?(c=t.split(","),n={funktion:r,badword:c[0],imagelabelid:e,badwordid:a,action:o}):"label"==r&&(n={funktion:r,imagelabelid:e,action:o});let l=[];if("cut"==o&&await d("Are you sure you want to delete this record?","Confirmation"),console.log(n),await i(n,s.badwords).then((t=>{console.log("Erfolg:",t)})).catch((t=>{"Error: status 409"===t&&l.push(c[0])})),("badword"==r||"metabadword"==r)&&"add"===o&&c.length>1){let t=c.slice(1);for(const e of t)n.badword=e,await i(n,s.badwords).then((t=>{console.log("Erfolg:",t)})).catch((t=>{"Error: status 409"===t&&l.push(e)}))}l.length>=1&&await d("The word"+(1===l.length?" ":"s ")+l.join(", ")+" could not be "+("add"===o?"added":"changed")+" because "+(1===l.length?"it":"they")+" already exists.","Duplicate"),l.length>0&&l.length===c.length||setTimeout((()=>{window.location.reload()}),100)}}));
